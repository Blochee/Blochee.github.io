<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>MCS-51单片机的硬件结构</title>
      <link href="/2023/11/19/MCS-51%E5%8D%95%E7%89%87%E6%9C%BA%E7%9A%84%E7%A1%AC%E4%BB%B6%E7%BB%93%E6%9E%84/"/>
      <url>/2023/11/19/MCS-51%E5%8D%95%E7%89%87%E6%9C%BA%E7%9A%84%E7%A1%AC%E4%BB%B6%E7%BB%93%E6%9E%84/</url>
      
        <content type="html"><![CDATA[<h1 id="MCS-51单片机的硬件结构"><a href="#MCS-51单片机的硬件结构" class="headerlink" title="MCS-51单片机的硬件结构"></a>MCS-51单片机的硬件结构</h1><h2 id="MCS-51的组成"><a href="#MCS-51的组成" class="headerlink" title="MCS-51的组成"></a>MCS-51的组成</h2><p><img src="/images/image-20231119175759007.png" alt="image-20231119175759007"></p><h2 id="MCS-51的引脚"><a href="#MCS-51的引脚" class="headerlink" title="MCS-51的引脚"></a>MCS-51的引脚</h2><p>40只引脚双列直插封装（DIP）</p><p><img src="/images/image-20231119175936599.png" alt="image-20231119175936599"></p><p>引脚逻辑图</p><p><img src="/images/image-20231119180007389.png" alt="image-20231119180007389"></p><h3 id="电源及时钟引脚"><a href="#电源及时钟引脚" class="headerlink" title="电源及时钟引脚"></a>电源及时钟引脚</h3><ol><li>电源引脚</li></ol><ul><li>Vcc（40脚）：+5V电源</li><li>Vss（20脚）：接地</li></ul><ol start="2"><li>时钟引脚</li></ol><ul><li>XTAL1（19）：采用外部晶振时，此引脚接地</li><li>XTAL2（18）</li></ul><h3 id="控制引脚"><a href="#控制引脚" class="headerlink" title="控制引脚"></a>控制引脚</h3><ol><li><p>RST&#x2F;VPD（9）：复位与备用电源（一定宽度的高电平复位）</p></li><li><p>ALE&#x2F;PROG<em>（30）</em></p><p>第一功能ALE：地址锁存允许（后面介绍）</p><p>第二功能PROG*：变成脉冲输入端</p></li><li><p>PSEN*（29）：读取外部存储器的选通信号</p></li><li><p>EA*&#x2F;VPP（31）</p><p>第一功能：EA*为内外程序存储器选择控制,为低电平时单片机只访问外部程序存储器</p><p>第二功能：用于施加编程电压（不研究）</p></li></ol><h3 id="I-O口引脚"><a href="#I-O口引脚" class="headerlink" title="I&#x2F;O口引脚"></a>I&#x2F;O口引脚</h3><ol><li>P0口：双向8位三态I&#x2F;O口，地址总线（低8位）及数据总线的分时复用口</li><li>P1口：8位准双向I&#x2F;O口，可驱动4个TTL负载</li><li>P2口：8位准双向I&#x2F;O口，与地址总线（高8位）复用</li><li>P3口：8位准双向I&#x2F;O口，双功能复用口</li></ol><p><img src="/images/image-20231119181609659.png" alt="image-20231119181609659"></p><p>准双向口和双向三态口的区别</p><ul><li>当三个准双向I&#x2F;O口做输入使用时，要向该口写1</li><li>准双向口无高阻的“浮空”状态</li></ul><h2 id="MCS-51的CPU（运算器和控制器）"><a href="#MCS-51的CPU（运算器和控制器）" class="headerlink" title="MCS-51的CPU（运算器和控制器）"></a>MCS-51的CPU（运算器和控制器）</h2><h3 id="运算器（对操作数进行算术、逻辑运算和位操作）"><a href="#运算器（对操作数进行算术、逻辑运算和位操作）" class="headerlink" title="运算器（对操作数进行算术、逻辑运算和位操作）"></a>运算器（对操作数进行算术、逻辑运算和位操作）</h3><ol><li>算术逻辑运算单元ALU</li><li>累加器A（Acc）</li></ol><ul><li>是ALU单元的输入之一，又是运算结果存放单元</li><li>是ALU单元的输入之一，又是运算结果存放单元</li><li>A的进位标志Cy同时又是位处理机的位累加器</li></ul><ol start="3"><li>程序状态字寄存器PSW</li></ol><p><img src="/images/image-20231119182211785.png" alt="image-20231119182211785"></p><ul><li>Cy（PSW.7）进位标志位 </li><li>Ac   (PSW.6)   辅助进位标志位</li><li>F0（PSW.5）标志位——由用户使用的一个状态标志位</li><li>RS1、RS0（PSW.4、PSW.3）：4组工作寄存器区选择控制位1和位0</li></ul><p><img src="/images/image-20231119182508472.png" alt="image-20231119182508472"></p><p>多组工作寄存器区可以保证数据的实时性，例如：当引入中断时，可以将RS0置1，改变中断程序使用的寄存器区，从而起到现场保护的作用。</p><ul><li>OV（PSW.2）溢出标志位：指示运算是否产生溢出（第三章详细介绍）</li><li>PSW.1位：保留位，未用</li><li>P(PSW.0)奇偶标志位：P&#x3D;1，A中“1”的个数为奇数；P&#x3D;0，A中“1”的个数为偶数</li></ul><p>奇偶标志位的应用：在串行通信中使用，提高串行通信的可靠性</p><h3 id="控制器"><a href="#控制器" class="headerlink" title="控制器"></a>控制器</h3><h4 id="程序计数器PC（Program-Counter）"><a href="#程序计数器PC（Program-Counter）" class="headerlink" title="程序计数器PC（Program Counter）"></a>程序计数器PC（Program Counter）</h4><p>作用：存放下一条要执行的指令在程序存储器中的地址</p><p>基本工作方式</p><ol><li><p>程序计数器自动加1</p></li><li><p>执行有条件或无条件转移指令时，程序计数器将被置入新的数值——&gt;程序流向发生变化</p></li><li><p>执行子程序调用或中断调用时完成下列操作</p></li></ol><ul><li>PC的当前值保护</li><li>将子程序入口地址或中断向量的地址送入PC</li></ul><h4 id="指令寄存器IR、指令译码器及控制逻辑电路"><a href="#指令寄存器IR、指令译码器及控制逻辑电路" class="headerlink" title="指令寄存器IR、指令译码器及控制逻辑电路"></a>指令寄存器IR、指令译码器及控制逻辑电路</h4><h2 id="MCS-51存储器结构"><a href="#MCS-51存储器结构" class="headerlink" title="MCS-51存储器结构"></a>MCS-51存储器结构</h2><p>哈佛（Har-vard）结构：程序存储器和外部数据存储器统一编址（冯诺依曼结构不是这样子的）</p><p>存储空间划分五类：程序存储器空间，内部数据存储器空间，外部数据存储器空间，SFR，位地址空间</p><p><img src="/images/image-20231119183726572.png"></p><p>注意：图中特殊功能寄存器SFR在内部数据存储器空间是离散分布的</p><h3 id="程序存储器"><a href="#程序存储器" class="headerlink" title="程序存储器"></a>程序存储器</h3><p>作用：存放应用程序和表格之类的固定常数</p><p>组成：分为片内和片外两部分，由EA<em>引脚上所接电平确定，该引脚为低电平时接入外部程序存储器。*<em>程序存储器中的0000H地址是系统程序的启动地址</em></em></p><p>5个特殊单元：用作五种中断源的中断入口地址，即中断向量</p><p><img src="/images/image-20231119184718530.png" alt="image-20231119184718530"></p><h3 id="内部数据存储器（128字节）"><a href="#内部数据存储器（128字节）" class="headerlink" title="内部数据存储器（128字节）"></a>内部数据存储器（128字节）</h3><p><img src="/images/image-20231119184957720.png" alt="image-20231119184957720"></p><h3 id="特殊功能寄存器SFR（21个）"><a href="#特殊功能寄存器SFR（21个）" class="headerlink" title="特殊功能寄存器SFR（21个）"></a>特殊功能寄存器SFR（21个）</h3><p>作用：51单片机通过写SFR来控制相应功能部件（定时器、串口、中断等）的工作方式，同时SFR也综合的、实际的反映了整个单片机系统内部的工作状态。例如：PSW</p><p><img src="/images/image-20231119185229054.png" alt="image-20231119185229054"></p><p><strong>注意：有的SFR可进行位寻址，其字节地址的末位是0H或8H</strong></p><p>下面是SFR中某些寄存器的简介：</p><ol><li><p>堆栈指针SP</p><p>指示出堆栈顶部在内部RAM块中的位置</p><p>堆栈向上生长，出栈后入先出</p><p>上电复位后SP内容默认为07H，作用是保护断点（PC）和现场保护（对Rn压栈）</p><p>由于07H与工作寄存器区重叠，因此使用前先赋值，一般用60H</p></li><li><p>数据指针DPTR</p><p>16位特殊功能寄存器，高位字节寄存器用DPH表示，低位字节寄存器用DPL表示</p></li><li><p>I&#x2F;O端口P0～P3</p><p>P0～P3分别为I&#x2F;O端口P0～P3的锁存器</p></li><li><p>寄存器B</p><p>为执行乘法和除法操作设置的</p><p>在不执行乘、除的情况下，可当作一个普通寄存器来使用</p></li><li><p>串行数据缓冲器SBUF</p><p>存放欲发送或已接收的数据，一个字节地址，物理上是由两个独立的寄存器组成，一个是发送缓冲器，另一个是接收缓冲器</p></li><li><p>定时器&#x2F;计数器</p><p>两个16位定时器&#x2F;计数器T1和T0，各由两个独立的8位寄存器组成： TH1、TL1、TH0、TL0，只能字<br>节寻址，但不能把T1或T0当作一个16位寄存器来寻址访问</p></li></ol><h3 id="位地址空间"><a href="#位地址空间" class="headerlink" title="位地址空间"></a>位地址空间</h3><p><img src="/images/image-20231119190252438.png" alt="image-20231119190252438"></p><p><img src="/images/image-20231119190303846.png" alt="image-20231119190303846"></p><ul><li>内部RAM的可寻址位128个(字节地址20H～2FH)，特殊功能寄存器SFR为83个可寻址位，共211个</li><li>SFR中字节地址为X0H或X8H的单元可以位寻址</li></ul><h3 id="外部数据存储器"><a href="#外部数据存储器" class="headerlink" title="外部数据存储器"></a>外部数据存储器</h3><ol><li><p>地址的重叠性</p><p><strong>程序存储器与数据存储器全部64K字节地址空间重叠</strong>。程序存储器与数据存储器在使用上是严格区分的：有不同的物理接线（PSEN*），不同的指令控制（MOVC和MOVX）</p></li><li><p><strong>片外数据存储区中，RAM与I&#x2F;O端口统一编址</strong>。所有外围I&#x2F;O端口的地址均占用RAM地址单元，使用与访问<br>外部数据存储器相同的传送指令</p></li></ol><p><img src="/images/image-20231119191044634.png" alt="image-20231119191044634"></p><p>上图是52系列单片机，不同点在于多了一个128字节的片内数据存储单元，它与SFR采用的寻址方式不同</p><p>SFR用直接寻址，片内RAM用简间接寻址</p><h2 id="并行I-O端口"><a href="#并行I-O端口" class="headerlink" title="并行I&#x2F;O端口"></a>并行I&#x2F;O端口</h2><p><strong>共有4个8位双向I&#x2F;O口，共32口线。每位均有自己的锁存器(SFR)，输出驱动器和输入缓冲器</strong></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>定时/计数器</title>
      <link href="/2023/11/19/%E5%AE%9A%E6%97%B6-%E8%AE%A1%E6%95%B0%E5%99%A8/"/>
      <url>/2023/11/19/%E5%AE%9A%E6%97%B6-%E8%AE%A1%E6%95%B0%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="第六章-定时计数器"><a href="#第六章-定时计数器" class="headerlink" title="第六章 定时计数器"></a>第六章 定时计数器</h1><h2 id="定时计数器的结构框图"><a href="#定时计数器的结构框图" class="headerlink" title="定时计数器的结构框图"></a>定时计数器的结构框图</h2><p><img src="/images/image-20231119152943798.png" alt="image-20231119152943798"></p><h2 id="定时器的控制字"><a href="#定时器的控制字" class="headerlink" title="定时器的控制字"></a>定时器的控制字</h2><h3 id="TMOD：工作方式控制寄存器（89H）"><a href="#TMOD：工作方式控制寄存器（89H）" class="headerlink" title="TMOD：工作方式控制寄存器（89H）"></a>TMOD：工作方式控制寄存器（89H）</h3><p><img src="/images/image-20231119153057581.png" alt="image-20231119153057581"></p><ol><li>GATE：门控位</li></ol><ul><li>GATE&#x3D;1，INT0引脚控制T0运行，INT1引脚控制T1运行，可测量这两引脚出现的正脉冲宽度</li><li>GATE&#x3D;0，定时计数器的运行不受外部引脚INT1或INT0的控制</li></ul><ol start="2"><li>C&#x2F;T：计数器模式和定时器模式的选择位</li></ol><ul><li>C&#x2F;T&#x3D;0时，定时器模式。每个机器周期定时器加一</li><li>C&#x2F;T&#x3D;1时，计数器模式。外部相应输入脚T0（p3.4）或T1（p3.5）产生下降沿时，计数器加一</li></ul><ol start="3"><li>M1、M0：工作方式 选择位</li></ol><table><thead><tr><th>M0</th><th align="left">M1</th><th>工作方式</th></tr></thead><tbody><tr><td>0</td><td align="left">0</td><td>方式0：TLX中低五位与THX中8位组成十三位计数器</td></tr><tr><td>1</td><td align="left">0</td><td>方式1：TLX与THX组成16位计数器</td></tr><tr><td>0</td><td align="left">1</td><td>方式2：常数自动重装载的8位计数器，相当于TLX溢出时，将THX中的内容赋给了TLX</td></tr><tr><td>1</td><td align="left">1</td><td>方式3：仅适用于T0，分成两个8位计数器，T1停止计数</td></tr></tbody></table><ol start="4"><li>注意：TMOD不能位寻址</li></ol><h3 id="TCON：控制寄存器（88H）"><a href="#TCON：控制寄存器（88H）" class="headerlink" title="TCON：控制寄存器（88H）"></a>TCON：控制寄存器（88H）</h3><p><img src="/images/image-20231119154859192.png" alt="image-20231119154859192"></p><ul><li><p>TF1：T1计数溢出标志位。由硬件控制，计数溢出时，由硬件置1。<strong>进入中断服务程序后被硬件自动清零</strong>。</p></li><li><p>TR1：T1计数运行控制位。由软件控制。</p><pre><code>当GATE位（TMOD.7）＝0时，若TR1=1，允许T1计数当GATE位=1时，TR1＝1且INT1=1时，允许T1计数</code></pre></li><li><p>TF0：T0计数溢出标志位，功能同TF1。</p></li><li><p>TR0：T0计数运行控制位，由软件置1或清0。</p><pre><code>当GATE位（TMOD.3）＝0时，若TR0=1，允许T0计数当GATE位=1时，TR0＝1且INT0=1时，允许T0计数。</code></pre></li></ul><h2 id="定时-计数器的四种工作方式"><a href="#定时-计数器的四种工作方式" class="headerlink" title="定时&#x2F;计数器的四种工作方式"></a>定时&#x2F;计数器的四种工作方式</h2><ol><li><p>T1工作在方式0的等效框图</p><p><img src="/images/image-20231119160056978.png" alt="image-20231119160056978"></p></li></ol><ul><li>GATE&#x3D;0时，A点始终为1，B点的控制始终由TR1决定</li><li>GATE&#x3D;1时，A点由INT1引脚控制，因此B点由TR1和INT1共同决定</li><li>C&#x2F;T低电平接内部时钟，高电平接外部引脚</li><li>方式1和方式0控制方式完全相同，只是一个是16位计数器，一个是13位计数器</li></ul><ol start="2"><li><p>T1工作在方式2等效框图</p><p><img src="/images/image-20231119160704137.png" alt="image-20231119160704137"></p></li></ol><ul><li>相当于自动赋初值，初值为TH1</li><li>该方式可以简化定时常数的计算方法（确定计数初值），可相当精确的确定定时时间，例：波特率发生器</li></ul><ol start="3"><li><p>工作于方式3的T0</p><p><img src="/images/image-20231119161137288.png" alt="image-20231119161137288"></p></li></ol><ul><li>TL0使用T0的状态控制位C&#x2F;T, GATE,TR0, INT0，而TH0被固定为一个8位定时器（不能作外部计数方式），并<strong>使用定时器T1的状态控制位TR1和TF1，同时占用定时器T1的中断源</strong>。</li><li>此时T1可以工作在方式0~2，但最好工作在方式2，经常做为串行口波特率发生器</li></ul><p><img src="/images/image-20231119161848107.png" alt="image-20231119161848107"></p><h2 id="定时-计数器的输入信号"><a href="#定时-计数器的输入信号" class="headerlink" title="定时&#x2F;计数器的输入信号"></a>定时&#x2F;计数器的输入信号</h2><h3 id="工作于定时器方式"><a href="#工作于定时器方式" class="headerlink" title="工作于定时器方式"></a>工作于定时器方式</h3><p>对内部时钟信号计数，内部时钟信号的频率为时钟振荡频率的1&#x2F;12，即每个机器周期计数值加1</p><h3 id="工作于计数器方式"><a href="#工作于计数器方式" class="headerlink" title="工作于计数器方式"></a>工作于计数器方式</h3><p>计数脉冲来自外部输入引脚T0或T1。当输入信号产生由1至0的跳变（即下跳变）时，计数器的值增1</p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
